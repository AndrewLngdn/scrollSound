<html>
<body style="height:4000px">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
	<script src="buffer-loader.js"></script>


	<div style="background-color:grey; height:50px; overflow:auto" class="a">awef lakwjef bakwehjbf akwbf akwehbf akwehfb kawhefb akwhefb akwehbf kawhebf kahwefb akwhebf akwehfb kawhefb kawhefb kahwef awef awef awef awef awef awefawef lakwjef bakwehjbf akwbf akwehbf akwehfb kawhefb akwhefb akwehbf kawhebf kahwefb akwhebf akwehfb kawhefb kawhefb kahwef awef awef awef awef awef awefawef lakwjef bakwehjbf akwbf akwehbf akwehfb kawhefb akwhefb akwehbf kawhebf kahwefb akwhebf akwehfb kawhefb kawhefb kahwef awef awef awef awef awef awefawef lakwjef bakwehjbf akwbf akwehbf akwehfb kawhefb akwhefb akwehbf kawhebf kahwefb akwhebf akwehfb kawhefb kawhefb kahwef awef awef awef awef awef awefawef lakwjef bakwehjbf akwbf akwehbf akwehfb kawhefb akwhefb akwehbf kawhebf kahwefb akwhebf akwehfb kawhefb kawhefb kahwef awef awef awef awef awef awefawef lakwjef bakwehjbf akwbf akwehbf akwehfb kawhefb akwhefb akwehbf kawhebf kahwefb akwhebf akwehfb kawhefb kawhefb kahwef awef awef awef awef awef awef</a>


	<script> 

	gainNodes = [];
	sources = [];

	(function($){
		window.onload = init;
		initialized = false;
		var context;
		var bufferLoader;
		// var sources = [];
		// var gainNodes = [];
		var parent;

		function init() {
		// Fix up prefixing
		window.AudioContext = window.AudioContext || window.webkitAudioContext;
		context = new AudioContext();
		$(window).trigger("contextLoaded");

		}

		function loadBuffer(url) {
		bufferLoader = new BufferLoader(
		context,
		[
		url
		],
		finishedLoading
		);

		bufferLoader.load();
		}
		

		function createSource(buffer) {
			var source = context.createBufferSource();
			// Create a gain node.
			var gainNode = context.createGain();
			source.buffer = buffer;
			// Turn on looping.
			source.loop = true;
			// Connect source to gain.
			source.connect(gainNode);
			// Connect gain to destination.
			gainNode.connect(context.destination);
			gainNode.gain.value = 0.0;


			parent.scroll(function(){
				if ($(this).scrollTop() > 500 
					&& $(this).scrollTop() < 700
					){
					console.log("settingGain to 1");
					gainNode.gain.value = 1.0;

					console.log(gainNodes[0].gain.value );
					console.log($(this).scrollTop());
				} else {
					gainNode.gain.value = 0.0;
				}
			});

			return {
			source: source,
			gainNode: gainNode
			};
		}

		function finishedLoading(bufferList) {
			console.log("started loading");
		// Create two sources and play them both together.
			var gainNode = createSource(bufferList[0]).gainNode;
			var source = createSource(bufferList[0]).source;
			gainNodes.push(gainNode);
			sources.push(source);
			source.start(0);
			// sources.push(source1);
			// source2.start(0);
			console.log("finsiehd loading");

			// playSound(gainNode.buffer);
			console.log(parent);
			// parent.scroll(function(){
				// console.log("here");
				// gainNodes[0].gain.value = 0.0;

				// if ($(this).scrollTop() > 500 
				// 	&& $(this).scrollTop() < 700
				// 	){
				// 	console.log("settingGain to 1");
				// 	gainNode.gain.value = 1.0;

				// 	console.log(gainNodes[0].gain.value );
				// 	console.log($(this).scrollTop());

				// }
			// });

			return {
			source: source,
			gainNode: gainNode
			};

		}

		// function playSound(buffer) {
		// 	var source = context.createBufferSource(); 
		// 	source.buffer = buffer;
		// 	source.connect(context.destination); 
		// 	source.start(0); 
		// }


		$.fn.scrollSound = function(sound, height) {
			parent = this;
			$(window).on('contextLoaded', function(){
				loadBuffer(sound);

			})
			return this;
		}
	})(jQuery);
		
		$(document).scrollSound("pptwaves.mp3");
		// $(".a").scrollSound();
	</script>
	
</body>
</html>

